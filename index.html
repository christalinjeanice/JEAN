<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Bisnis Digital ISTTS</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Konfigurasi Font Inter dan Custom Styling -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* --- BACKGROUND DIPERBARUI DI SINI --- */
        body {
            font-family: 'Inter', sans-serif;
            
            /* Latar Belakang Gedung ISTTS */
            background-image: url('https://asset-2.tribunnews.com/tribunnewswiki/foto/bank/images/institut-sains-dan-teknologi-terpadu-surabaya-istts.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Membuat latar belakang tetap saat menggulir */
            background-color: #f7f9fb; /* Warna fallback */
        }
        
        /* KUNCI PERUBAHAN: Opacity diubah dari 0.8 menjadi 0.6 agar latar belakang lebih terlihat jelas */
        #app {
            background-color: rgba(247, 249, 251, 0.6); 
            min-height: 100vh;
        }
        /* --- AKHIR BACKGROUND BARU --- */

        /* Style Transisi untuk tampilan yang halus */
        .view-container {
            transition: opacity 0.3s ease-in-out;
        }
        .main-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.1), 0 4px 6px -4px rgba(37, 99, 235, 0.1);
        }

        /* Styling Chatbot */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* Styling Word Search Game */
        .no-select { user-select: none; -webkit-user-select: none; touch-action: none; }
        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: background-color 0.1s;
            background-color: white;
        }
        @media (max-width: 640px) { .cell { font-size: 0.6rem; } }
        .cell:hover { background-color: #e0f2fe; }
        .cell.selected { background-color: #fbbf24; color: #000; transform: scale(1.1); z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } 
        .cell.found { background-color: #0ea5e9; color: white; border-color: #0284c7; }
        .word-item { transition: all 0.3s; padding: 4px 8px; border-radius: 4px; }
        .word-item.found { text-decoration: line-through; color: #94a3b8; background-color: #f1f5f9; }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .info-popup { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="relative min-h-screen">
        <!-- Main Navigation Header (Selalu terlihat) -->
        <header class="bg-blue-900 shadow-lg sticky top-0 z-50">
            <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <!-- Logo ISTTS di Navbar -->
                    <img src="https://infopmb.istts.ac.id/wp-content/uploads/2019/11/istts-1.png" alt="Logo ISTTS" class="h-8 object-contain" onerror="this.onerror=null;this.src='https://placehold.co/100x40/ffffff/000000?text=ISTTS'">
                    <span class="text-xl font-bold text-white hidden sm:block">
                        MBD ISTTS
                    </span>
                </div>
                <!-- Tombol Home (Hanya terlihat di sub-halaman) -->
                <button id="home-btn-nav" onclick="setView('home')" class="hidden bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded-full text-sm transition-colors shadow-md">
                    Home
                </button>
            </nav>
        </header>

        <!-- Container untuk tampilan dinamis -->
        <main id="view-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
            
            <!-- 1. HOME VIEW -->
            <div id="home-view" class="view-container">
                <div class="bg-white rounded-xl shadow-2xl overflow-hidden mb-8 p-6 md:p-10">
                    
                    <!-- Logo MBD dan Judul -->
                    <div class="flex flex-col md:flex-row items-center gap-6 mb-6">
                        <img src="https://infopmb.istts.ac.id/wp-content/uploads/2024/08/WEBP-MBD-POSTER-1024x576.png" alt="Logo MBD" class="w-full md:w-1/3 max-w-sm rounded-lg shadow-xl" onerror="this.onerror=null;this.src='https://placehold.co/300x150/f0f9ff/0c4a6e?text=Logo+MBD'" />
                        <div>
                            <h1 class="text-3xl md:text-5xl font-extrabold text-blue-900 mb-2 mt-4 md:mt-0">
                                Manajemen Bisnis Digital
                            </h1>
                            <h2 class="text-xl md:text-2xl font-semibold text-blue-700">
                                ISTTS
                            </h2>
                        </div>
                    </div>
                    
                    <p class="text-lg text-gray-600 mb-6 border-b pb-4">
                        Mencetak Digital Leader dan Entrepreneur Masa Depan.
                    </p>
                    
                    <div class="space-y-4">
                        <p class="text-gray-700 leading-relaxed">
                            Program Studi Manajemen Bisnis Digital (MBD) di ISTTS menawarkan kurikulum yang mengintegrasikan strategi bisnis konvensional dengan teknologi digital terkini. Kami fokus pada pengembangan kemampuan analisis data, pemasaran digital, e-commerce, dan manajemen proyek digital. Lulusan MBD siap menjadi profesional yang dapat mendorong transformasi digital di berbagai industri, atau menjadi pendiri startup yang inovatif.
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 ml-4">
                            <li>Prospek Karir Luas: Data Analyst, E-commerce Manager, Digital Marketing Specialist.</li>
                            <li>Sistem Kuliah Hybrid (Online & Offline).</li>
                            <li>Program Tanpa Skripsi (Fokus pada Proyek Nyata).</li>
                            <li>Kesempatan Magang Setelah 2.5 Tahun Kuliah.</li>
                        </ul>
                    </div>
                </div>

                <!-- Bagian Tombol Fitur -->
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Eksplorasi Lebih Lanjut</h2>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
                    <!-- Tombol Chatbot -->
                    <button onclick="setView('chatbot')" class="main-button bg-blue-600 text-white p-6 rounded-xl shadow-lg hover:bg-blue-700 flex flex-col items-center text-center">
                        <!-- Icon MessageSquare -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square mb-2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        <span class="font-semibold text-xl">Tanya MBD Chatbot</span>
                        <span class="text-sm opacity-80 mt-1">FAQ seputar pendaftaran & kurikulum.</span>
                    </button>
                    <!-- Tombol Filter Foto AI -->
                    <button onclick="setView('photofilter')" class="main-button bg-indigo-600 text-white p-6 rounded-xl shadow-lg hover:bg-indigo-700 flex flex-col items-center text-center">
                         <!-- Icon UserCheck -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check mb-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>
                        <span class="font-semibold text-xl">Headshot CV AI</span>
                        <span class="text-sm opacity-80 mt-1">Ubah foto biasa jadi profesional.</span>
                    </button>
                    <!-- Tombol Game -->
                    <button onclick="setView('game')" class="main-button bg-teal-600 text-white p-6 rounded-xl shadow-lg hover:bg-teal-700 flex flex-col items-center text-center">
                        <!-- Icon Puzzle -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-puzzle mb-2"><path d="M19.439 7.854a2.25 2.25 0 0 0 1.48-2.88l-.348-.867a.75.75 0 0 0-1.042-.26l-1.636 1.022a.75.75 0 0 1-.954-.236 2.25 2.25 0 0 0-3.32.064L11.5 5.5l-.337.892a2.25 2.25 0 0 0 1.48 2.88l.348.867a.75.75 0 0 0 1.042.26l1.636-1.022a.75.75 0 0 1 .954.236 2.25 2.25 0 0 0 3.32-.064z"/><path d="M12.5 18.5a.5.5 0 0 0-1 0v.5a.5.5 0 0 0 1 0z"/><path d="M10 12.5a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 0-1z"/><path d="M14 12.5a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 0-1z"/><path d="M11 9.5a.5.5 0 0 0-1 0v.5a.5.5 0 0 0 1 0z"/></svg>
                        <span class="font-semibold text-xl">Game MBD Word Search</span>
                        <span class="text-sm opacity-80 mt-1">Temukan fakta menarik MBD.</span>
                    </button>
                </div>

                <!-- Bagian Kontak -->
                <div class="bg-gray-100 p-6 md:p-8 rounded-xl shadow-inner border border-gray-200">
                    <h2 class="text-2xl font-bold text-blue-800 mb-4 flex items-center gap-2">
                        <!-- Icon Phone -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-contact text-blue-600"><path d="M17 18a2 2 0 0 0-2-2H9a2 2 0 0 0-2 2"/><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="12" cy="10" r="2"/></svg>
                        Hubungi Kami
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <a href="https://www.instagram.com/mbd.istts?igsh=MXN3bDNnOGc2NmNmbA==" target="_blank" class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100">
                            <!-- Icon Instagram -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram text-pink-600"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
                            <span class="font-medium text-gray-700">Instagram MBD</span>
                        </a>
                        <a href="https://www.instagram.com/haloistts?igsh=MXdrcmF3OGhzanUwNQ==" target="_blank" class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100">
                            <!-- Icon Instagram -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-instagram text-pink-600"><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></svg>
                            <span class="font-medium text-gray-700">Instagram ISTTS</span>
                        </a>
                        <a href="https://infopmb.istts.ac.id/" target="_blank" class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100">
                            <!-- Icon Globe -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe text-blue-600"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
                            <span class="font-medium text-gray-700">Website PMB ISTTS</span>
                        </a>
                        <a href="https://www.tiktok.com/@haloistts?_r=1&_t=ZS-91gjyuZ7V8k" target="_blank" class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100">
                            <!-- Icon TikTok placeholder (using Feather icon) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-music text-gray-800"><path d="M9 18V5h12v13a4 4 0 0 1-4 4H9V8"/><circle cx="5" cy="20" r="2"/></svg>
                            <span class="font-medium text-gray-700">TikTok ISTTS</span>
                        </a>
                        <!-- Email diubah menjadi teks statis -->
                        <div class="flex items-center gap-3 p-3 bg-white rounded-lg shadow-sm border border-gray-100 text-gray-700">
                            <!-- Icon Mail -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail text-red-500"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                            <span class="font-medium">pmb@istts.ac.id</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. CHATBOT VIEW -->
            <div id="chatbot-view" class="view-container hidden min-h-[80vh] flex flex-col">
                <!-- Tombol Kembali -->
                <button onclick="setView('home')" class="mb-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-full text-sm self-start transition-colors flex items-center gap-2">
                    <!-- Icon ArrowLeft -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    Kembali ke Home
                </button>
                
                <!-- Kontainer Chatbot -->
                <div id="chatbot-container" class="flex flex-col flex-1 h-[70vh] bg-white rounded-xl shadow-2xl overflow-hidden">
                    
                    <!-- Chat Header -->
                    <div class="bg-gradient-to-r from-blue-700 to-teal-500 text-white p-4 shadow-lg flex justify-between items-center z-10">
                        <div class="flex items-center gap-3">
                             <!-- Icon Bot -->
                            <div class="p-2 bg-white/20 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                            </div>
                            <div>
                                <h1 class="font-bold text-lg">MBD ISTTS Assistant</h1>
                                <p class="text-xs text-blue-100 flex items-center gap-1">
                                    <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                                    Online
                                </p>
                            </div>
                        </div>
                        <button 
                            id="reset-chat-btn"
                            class="p-2 hover:bg-white/10 rounded-full transition-colors"
                            title="Reset Chat"
                        >
                            <!-- Icon RefreshCw -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.76L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.76L3 16"/><path d="M3 21v-5h5"/></svg>
                        </button>
                    </div>

                    <!-- Chat Area -->
                    <div id="messages-container" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 relative scroll-smooth scrollbar-hide">
                        <!-- Messages will be appended here -->
                        <div id="messages-end-ref"></div>
                    </div>

                    <!-- Quick Questions (Horizontal Scroll) -->
                    <div id="quick-tips-container" class="bg-white border-t border-gray-100 p-2">
                        <!-- Tips will be generated here -->
                    </div>

                    <!-- Input Area -->
                    <div class="bg-white p-4 border-t border-gray-200 shadow-md pb-6 md:pb-4">
                        <div class="flex gap-2 relative">
                            <input
                                type="text"
                                id="chat-input"
                                placeholder="Tulis pertanyaanmu tentang MBD ISTTS..."
                                class="flex-1 bg-gray-100 text-gray-800 rounded-full px-5 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all text-sm"
                            />
                            <button
                                id="send-chat-btn"
                                class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-3 rounded-full shadow-lg transition-transform active:scale-90 flex items-center justify-center"
                            >
                                <!-- Icon Send -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4 20-7z"/></svg>
                            </button>
                        </div>
                        <div class="text-center mt-2">
                            <p class="text-[10px] text-gray-400">Bot ini menggunakan data resmi FAQ ISTTS.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. PHOTO FILTER VIEW (Headshot CV AI) -->
            <div id="photofilter-view" class="view-container hidden">
                <!-- Tombol Kembali -->
                <button onclick="setView('home')" class="mb-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-full text-sm self-start transition-colors flex items-center gap-2">
                    <!-- Icon ArrowLeft -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    Kembali ke Home
                </button>
                
                <!-- Kontainer Photo Filter -->
                <div class="max-w-xl mx-auto bg-white shadow-2xl rounded-xl p-6 md:p-8">
                    <header class="text-center mb-6 md:mb-8">
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Pembuat Headshot CV AI</h1>
                        <p class="text-gray-500 mt-2">Ubah foto kasual Anda menjadi headshot profesional dalam sekejap.</p>
                    </header>

                    <!-- Bagian Input Foto -->
                    <div class="mb-6">
                        <label for="photo-input" class="block text-sm font-medium text-gray-700 mb-2">1. Unggah Foto Wajah Anda:</label>
                        <input type="file" id="photo-input" accept="image/*" class="w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-indigo-50 file:text-indigo-700
                            hover:file:bg-indigo-100" />
                        <p class="text-xs text-gray-400 mt-2">Pastikan wajah terlihat jelas dan pencahayaan memadai.</p>
                    </div>

                    <!-- Pratinjau Foto Asli -->
                    <div id="original-preview-container" class="mb-6 hidden">
                        <h2 class="text-lg font-semibold text-gray-700 mb-3">Foto Asli:</h2>
                        <div class="flex justify-center">
                            <img id="original-image" class="max-w-full h-auto max-h-64 object-contain rounded-lg shadow-md border border-gray-200" alt="Pratinjau Foto Asli" />
                        </div>
                    </div>

                    <!-- Bagian Opsi Kustomisasi (Prompt) -->
                    <div class="mb-8">
                        <label for="prompt-input" class="block text-sm font-medium text-gray-700 mb-2">2. Instruksi Gaya (Opsional):</label>
                        <textarea id="prompt-input" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm" placeholder="Contoh: 'Ubah menjadi blazer navy dengan kemeja putih, latar belakang abu-abu polos. Ekspresi serius.'"></textarea>
                        <p class="text-xs text-gray-400 mt-2">Jika kosong, akan menggunakan gaya profesional standar.</p>
                    </div>

                    <!-- Tombol Generate -->
                    <div class="text-center mb-8">
                        <button id="generate-btn" class="w-full sm:w-auto px-6 py-3 text-white bg-indigo-600 rounded-full font-semibold shadow-lg btn-primary hover:bg-indigo-700 disabled:bg-indigo-300 disabled:cursor-not-allowed flex items-center justify-center mx-auto" disabled>
                            <!-- Icon Loading Spinner -->
                            <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span id="button-text">Ubah Foto Jadi Headshot (AI)</span>
                        </button>
                    </div>

                    <!-- Bagian Hasil -->
                    <div id="result-container" class="mt-6 hidden">
                        <h2 class="text-lg font-semibold text-gray-700 mb-3">3. Hasil Headshot Profesional:</h2>
                        <div id="image-output-area" class="flex justify-center p-4 bg-gray-100 rounded-lg shadow-inner min-h-64">
                            <img id="result-image" class="max-w-full h-auto max-h-96 object-contain rounded-lg shadow-xl" alt="Hasil Foto Headshot CV" />
                            <p id="placeholder-text" class="text-gray-500 self-center hidden">Gambar akan muncul di sini setelah diproses.</p>
                        </div>
                        <!-- Tombol Download -->
                        <div class="text-center mt-4">
                            <a id="download-btn" class="hidden px-4 py-2 text-sm text-white bg-green-600 rounded-full font-semibold hover:bg-green-700 btn-primary" href="#" download="headshot_cv_gemini.png">Unduh Hasil</a>
                        </div>
                    </div>

                    <!-- Area Pesan/Error -->
                    <div id="message-box" class="mt-6 p-4 rounded-lg text-sm transition-all duration-300 hidden"></div>
                </div>
            </div>

            <!-- 4. GAME VIEW (Word Search) -->
            <div id="game-view" class="view-container hidden">
                <!-- Tombol Kembali -->
                <button onclick="setView('home')" class="mb-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-full text-sm self-start transition-colors flex items-center gap-2">
                    <!-- Icon ArrowLeft -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                    Kembali ke Home
                </button>
                
                <!-- Kontainer Game -->
                <div class="max-w-5xl mx-auto w-full bg-white rounded-2xl shadow-xl overflow-hidden">
                    <!-- Header Game -->
                    <div class="bg-blue-900 text-white p-6 text-center">
                        <h1 class="text-2xl md:text-3xl font-bold mb-1">MANAJEMEN BISNIS DIGITAL</h1>
                        <p class="text-blue-200 text-sm md:text-base">Temukan kata kunci seputar MBD ISTTS & buka faktanya!</p>
                    </div>

                    <div class="flex flex-col lg:flex-row p-6 gap-8">
                        
                        <!-- Kiri: Game Area -->
                        <div class="flex-1 flex flex-col items-center">
                            <div id="grid-bg" class="bg-blue-100 p-2 rounded-lg shadow-inner">
                                <div id="grid-container" class="grid gap-0.5">
                                    <!-- Grid generated by JS -->
                                </div>
                            </div>
                            <div id="status-msg" class="h-8 mt-4 font-bold text-blue-700 text-lg text-center"></div>
                        </div>

                        <!-- Kanan: Info & List -->
                        <div class="w-full lg:w-80 flex flex-col gap-4">
                            
                            <!-- Info Box (Fact Reveal) -->
                            <div id="fact-box" class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded shadow-sm hidden">
                                <h4 class="font-bold text-orange-700 text-sm mb-1">TAHUKAH KAMU?</h4>
                                <p id="fact-text" class="text-sm text-gray-700 leading-relaxed"></p>
                            </div>

                            <!-- Word List -->
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex-1">
                                <h3 class="font-bold text-gray-800 mb-3 border-b pb-2 flex justify-between items-center">
                                    <span>Daftar Kata</span>
                                    <span id="score" class="text-blue-600 text-sm">0/0</span>
                                </h3>
                                <div id="word-list" class="grid grid-cols-2 gap-2 text-xs md:text-sm text-gray-600 font-medium">
                                    <!-- Word list generated by JS -->
                                </div>
                            </div>

                            <button id="reset-game-btn" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 px-4 rounded-lg transition shadow-md flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                                </svg>
                                Acak Ulang
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- MAIN JAVASCRIPT LOGIC -->
    <script>
        // --- 0. State dan Utility Global ---
        let currentView = 'home';
        const views = {
            home: document.getElementById('home-view'),
            chatbot: document.getElementById('chatbot-view'),
            photofilter: document.getElementById('photofilter-view'),
            game: document.getElementById('game-view'),
        };
        const homeNavBtn = document.getElementById('home-btn-nav');
        
        /** Mengubah tampilan aplikasi */
        function setView(viewName) {
            Object.keys(views).forEach(key => {
                views[key].classList.add('hidden');
            });
            
            // Tampilkan view yang diminta
            const targetView = views[viewName];
            targetView.classList.remove('hidden');
            targetView.classList.add('view-container'); // Pastikan kelas transisi ada
            
            // Tampilkan/Sembunyikan tombol "Home" di header navigasi
            if (viewName !== 'home') {
                homeNavBtn.classList.remove('hidden');
                // Panggil inisialisasi jika pindah ke sub-halaman
                if (viewName === 'chatbot') initChatbot();
                if (viewName === 'game') initGame();
                // Photo filter tidak perlu initGame karena state dipertahankan
            } else {
                homeNavBtn.classList.add('hidden');
            }
            
            // Gulir ke atas halaman utama
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        // --- 1. CHATBOT LOGIC (Konversi dari React) ---
        
        const QA_DATA = [
            {
                id: 1,
                keywords: ['kapan', 'daftar', 'pendaftaran', 'buka', 'tanggal', 'periode'],
                question: "Kapan periode pendaftaran untuk program studi Manajemen Bisnis Digital (MBD) di ISTTS dibuka?",
                answer: "Pendaftaran untuk program studi Manajemen Bisnis Digital (MBD) di ISTTS biasanya dibuka pada bulan September 2025. Untuk penjelasan lebih lanjut, silakan hubungi BAA."
            },
            {
                id: 2,
                keywords: ['biaya', 'harga', 'bayar', 'uang kuliah', 'spp', 'semester', 'total'],
                question: "Berapakah estimasi total biaya kuliah per semester?",
                // JAWABAN SUDAH DIPERBARUI: Rp22.000.000 an
                answer: "Biaya kuliah per semester untuk program MBD adalah sekitar Rp22.000.000 an sebelum beasiswa dan promo lainnya."
            },
            {
                id: 3,
                keywords: ['lulus', 'kerja', 'karir', 'job', 'profesi', 'prospek', 'jadi apa'],
                question: "Apa prospek karir setelah lulus dari MBD ISTTS?",
                answer: "Lulusan dapat menjadi Data Analyst, Manager Marketing, Entrepreneur/Pendiri Bisnis Digital, Digital Marketing Specialist, E-commerce Manager, Digital Business Consultant, CDO (Chief Digital Officer), hingga Digital Transformation Manager."
            },
            {
                id: 4,
                keywords: ['unggul', 'beda', 'kelebihan', 'banding', 'spesial', 'unik', 'magang', 'skripsi'],
                question: "Apa keunggulan kompetitif MBD ISTTS dibanding program lain?",
                answer: "Keunggulan utama adalah kesempatan magang setelah 2,5 tahun kuliah, dan program ini TIDAK mewajibkan Skripsi. Selain itu, terdapat program kuliah hybrid (online & offline)."
            },
            {
                id: 5,
                keywords: ['beasiswa', 'diskon', 'promo', 'potongan', 'gratis', 'keringanan'],
                question: "Apakah tersedia program beasiswa?",
                answer: "Ya. 10 pendaftar pertama yang memenuhi syarat mendapat diskon 100% biaya kuliah semester 1 dan diskon 50% untuk semester 2-7. Tersedia juga beasiswa 100% bagi siswa berprestasi."
            },
            {
                id: 6,
                keywords: ['usia', 'umur', 'tua', 'muda', 'syarat', 'minimal', 'tahun'],
                question: "Apa persyaratan usia minimal untuk mendaftar?",
                answer: "Syarat pendaftaran minimal usia untuk program MBD ISTTS adalah wajib berusia minimal 17 tahun."
            },
            {
                id: 7,
                keywords: ['online', 'offline', 'daring', 'luring', 'hybrid', 'sistem', 'kuliah', 'metode'],
                question: "Apakah perkuliahan online, offline, atau hybrid?",
                answer: "MBD ISTTS menerapkan sistem perkuliahan Hybrid, yang berarti kuliah dapat dilakukan secara online maupun offline, tergantung pada jadwal dan mata kuliah yang bersangkutan."
            },
            {
                id: 8,
                keywords: ['ajar', 'belajar', 'materi', 'kurikulum', 'matkul', 'fokus', 'pelajaran'],
                question: "Apa fokus utama kurikulum MBD?",
                answer: "Kurikulum berfokus pada integrasi strategi bisnis konvensional dengan teknologi digital terkini, mencakup analisis data, pemasaran digital, e-commerce, dan manajemen proyek digital."
            },
            {
                id: 9,
                keywords: ['fasilitas', 'lab', 'gedung', 'komputer', 'ruangan', 'sarana'],
                question: "Fasilitas apa saja yang disediakan?",
                answer: "ISTTS menyediakan ruangan e-lib, laboratorium komputer modern dengan software analisis data dan desain, serta akses ke platform dan sumber belajar digital profesional."
            },
            {
                id: 10,
                keywords: ['industri', 'kerja', 'koneksi', 'mitra', 'perusahaan', 'hubung'],
                question: "Bagaimana hubungan dengan industri/dunia kerja?",
                answer: "ISTTS memiliki jaringan mitra industri yang kuat dan mewajibkan program magang setelah tahun kedua, memastikan mahasiswa memiliki pengalaman kerja relevan sebelum lulus."
            }
        ];

        let chatMessages = [];
        let isTyping = false;
        let showQuickTips = true;
        
        const messagesContainer = document.getElementById('messages-container');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const resetChatBtn = document.getElementById('reset-chat-btn');
        const quickTipsContainer = document.getElementById('quick-tips-container');

        /** Mencari jawaban dari data QA berdasarkan query */
        function findAnswer(query) {
            const lowerQuery = query.toLowerCase();
            let bestMatch = null;
            let maxMatches = 0;

            QA_DATA.forEach(item => {
                let matches = 0;
                item.keywords.forEach(keyword => {
                    if (lowerQuery.includes(keyword)) matches++;
                });

                if (lowerQuery.includes(item.question.toLowerCase())) matches += 10;

                if (matches > maxMatches) {
                    maxMatches = matches;
                    bestMatch = item;
                }
            });

            if (bestMatch && maxMatches > 0) {
                return bestMatch.answer;
            } else {
                return "Maaf, saya belum mengerti pertanyaan tersebut. Coba tanyakan tentang pendaftaran, biaya, kurikulum, atau prospek karir.";
            }
        }

        /** Render pesan tunggal ke DOM */
        function renderMessage(msg) {
            const msgEl = document.createElement('div');
            msgEl.classList.add('flex', 'animate-fadeIn', msg.sender === 'user' ? 'justify-end' : 'justify-start');
            
            const time = msg.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            // Icon SVG untuk Bot dan User
            const botIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>`;
            const userIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`;

            msgEl.innerHTML = `
                <div class="flex max-w-[85%] md:max-w-[70%] items-end gap-2 ${msg.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.sender === 'user' ? 'bg-indigo-500 text-white' : 'bg-teal-600 text-white'}">
                        ${msg.sender === 'user' ? userIcon : botIcon}
                    </div>
                    <div class="p-3.5 rounded-2xl shadow-sm text-sm leading-relaxed ${
                        msg.sender === 'user' 
                            ? 'bg-indigo-500 text-white rounded-br-none' 
                            : 'bg-white text-gray-800 border border-gray-200 rounded-bl-none'
                    }">
                        ${msg.text}
                        <div class="text-[10px] mt-1 text-right ${msg.sender === 'user' ? 'text-indigo-200' : 'text-gray-400'}">
                            ${time}
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(msgEl);
        }

        /** Menampilkan indikator bot sedang mengetik */
        function showTypingIndicator(show) {
            let indicator = document.getElementById('typing-indicator');
            if (show) {
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.id = 'typing-indicator';
                    indicator.classList.add('flex', 'justify-start', 'animate-pulse');
                    // Icon Bot SVG
                    const botIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot text-white"></svg>`;
                    indicator.innerHTML = `
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 bg-teal-600 rounded-full flex items-center justify-center">
                                ${botIcon}
                            </div>
                            <div class="bg-white border border-gray-200 p-3 rounded-2xl rounded-bl-none flex gap-1 items-center shadow-sm">
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 75ms;"></span>
                                <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
                            </div>
                        </div>
                    `;
                    messagesContainer.appendChild(indicator);
                }
            } else {
                if (indicator) {
                    indicator.remove();
                }
            }
            scrollToBottom();
        }

        /** Menggulir ke bawah chat */
        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /** Menangani pengiriman pesan dari user */
        function handleSend(text = chatInput.value) {
            if (isTyping || !text.trim()) return;

            // 1. Tambah Pesan User
            const userMsg = {
                id: chatMessages.length + 1,
                text: text.trim(),
                sender: 'user',
                timestamp: new Date()
            };
            chatMessages.push(userMsg);
            renderMessage(userMsg);
            
            chatInput.value = '';
            showQuickTips = false;
            renderQuickTips();
            
            // 2. Simulasi Respon Bot
            isTyping = true;
            showTypingIndicator(true);

            setTimeout(() => {
                const responseText = findAnswer(userMsg.text);
                const botMsg = {
                    id: chatMessages.length + 1,
                    text: responseText,
                    sender: 'bot',
                    timestamp: new Date()
                };
                chatMessages.push(botMsg);
                showTypingIndicator(false);
                renderMessage(botMsg);
                isTyping = false;
            }, 1000);
        }
        
        /** Render tombol pertanyaan cepat */
        function renderQuickTips() {
            quickTipsContainer.innerHTML = '';
            
            // Icon Close (X) SVG
            const closeIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`;

            if (showQuickTips) {
                const header = document.createElement('div');
                header.classList.add('mb-2', 'px-2', 'flex', 'justify-between', 'items-center', 'text-xs', 'text-gray-500', 'font-medium');
                header.innerHTML = `
                    <span>Pertanyaan Populer:</span>
                    <button id="close-tips-btn">${closeIcon}</button>
                `;
                quickTipsContainer.appendChild(header);

                document.getElementById('close-tips-btn').onclick = () => {
                    showQuickTips = false;
                    renderQuickTips();
                };

                const tipsWrapper = document.createElement('div');
                tipsWrapper.classList.add('flex', 'gap-2', 'overflow-x-auto', 'pb-2', 'px-2', 'scrollbar-hide');

                QA_DATA.forEach(item => {
                    const btn = document.createElement('button');
                    btn.classList.add('whitespace-nowrap', 'bg-blue-50', 'text-blue-700', 'px-4', 'py-2', 'rounded-full', 'text-xs', 'font-medium', 'border', 'border-blue-100', 'hover:bg-blue-100', 'hover:border-blue-300', 'transition-all', 'flex-shrink-0', 'active:scale-95');
                    btn.textContent = item.question.length > 30 ? item.question.substring(0, 30) + '...' : item.question;
                    btn.onclick = () => handleSend(item.question);
                    tipsWrapper.appendChild(btn);
                });
                quickTipsContainer.appendChild(tipsWrapper);
            }
        }

        /** Reset Chat */
        function resetChat() {
            chatMessages = [];
            messagesContainer.innerHTML = '<div id="messages-end-ref"></div>';
            isTyping = false;
            showQuickTips = true;
            
            // Tambahkan pesan awal bot
            const initialMsg = {
                id: 0,
                text: "Halo! Saya asisten virtual MBD ISTTS. Ada yang bisa saya bantu mengenai info jurusan Manajemen Bisnis Digital?",
                sender: 'bot',
                timestamp: new Date()
            };
            chatMessages.push(initialMsg);
            renderMessage(initialMsg);

            renderQuickTips();
            showTypingIndicator(false);
            chatInput.value = '';
        }
        
        /** Inisialisasi Chatbot (dipanggil saat view diaktifkan) */
        function initChatbot() {
             // Bersihkan event listener lama sebelum menambahkan yang baru
            sendChatBtn.onclick = null;
            chatInput.onkeypress = null;
            resetChatBtn.onclick = null;

            // Tambahkan event listener baru
            sendChatBtn.onclick = () => handleSend();
            chatInput.onkeypress = (e) => {
                if (e.key === 'Enter') handleSend();
            };
            resetChatBtn.onclick = resetChat;

            if (chatMessages.length === 0) {
                resetChat();
            } else {
                renderQuickTips(); // Hanya memastikan tips di-render jika ada state
                scrollToBottom();
            }
        }


        // --- 2. PHOTO FILTER LOGIC (Konversi dari kode user, dimodifikasi untuk integrasi) ---

        // API Key dan URL (dibiarkan kosong sesuai instruksi)
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

        // Elemen DOM (Hanya untuk Photo Filter)
        const photoInput = document.getElementById('photo-input');
        const generateBtn = document.getElementById('generate-btn');
        const originalImage = document.getElementById('original-image');
        const resultImage = document.getElementById('result-image');
        const resultContainer = document.getElementById('result-container');
        const messageBox = document.getElementById('message-box');
        const loadingSpinner = document.getElementById('loading-spinner');
        const buttonText = document.getElementById('button-text');
        const downloadBtn = document.getElementById('download-btn');
        const originalPreviewContainer = document.getElementById('original-preview-container');
        const promptInput = document.getElementById('prompt-input');

        let uploadedBase64 = null;
        let uploadedMimeType = null;

        /**
         * Mengubah file yang diunggah menjadi string Base64.
         */
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64String = reader.result.split(',')[1];
                    resolve({ base64: base64String, mimeType: file.type });
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        /**
         * Menampilkan pesan di kotak pesan.
         */
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.className = 'mt-6 p-4 rounded-lg text-sm transition-all duration-300';
            messageBox.classList.remove('hidden');

            switch (type) {
                case 'success':
                    messageBox.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'error':
                    messageBox.classList.add('bg-red-100', 'text-red-800');
                    break;
                case 'info':
                default:
                    messageBox.classList.add('bg-blue-100', 'text-blue-800');
                    break;
            }
        }

        // Listener untuk unggahan foto
        photoInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) {
                generateBtn.disabled = true;
                originalPreviewContainer.classList.add('hidden');
                showMessage("Silakan unggah file gambar.", 'info');
                return;
            }

            try {
                const { base64, mimeType } = await fileToBase64(file);
                uploadedBase64 = base64;
                uploadedMimeType = mimeType;

                // Tampilkan pratinjau foto asli
                originalImage.src = URL.createObjectURL(file);
                originalPreviewContainer.classList.remove('hidden');

                generateBtn.disabled = false;
                messageBox.classList.add('hidden');
                resultContainer.classList.add('hidden');
                downloadBtn.classList.add('hidden');

            } catch (error) {
                showMessage("Gagal memproses file. Pastikan itu adalah gambar yang valid.", 'error');
                generateBtn.disabled = true;
                originalPreviewContainer.classList.add('hidden');
                console.error("Error processing file:", error);
            }
        });


        // Listener untuk tombol Generate
        generateBtn.addEventListener('click', async () => {
            if (!uploadedBase64) {
                showMessage("Mohon unggah foto terlebih dahulu.", 'error');
                return;
            }

            // Atur status loading
            generateBtn.disabled = true;
            loadingSpinner.classList.remove('hidden');
            buttonText.textContent = 'Memproses Headshot...';
            messageBox.classList.add('hidden');
            resultContainer.classList.add('hidden');
            downloadBtn.classList.add('hidden');

            const userPrompt = promptInput.value.trim();
            
            // Instruksi default yang kuat
            const defaultInstruction = "ubah foto ini menjadi headshot profesional untuk CV. Ganti pakaian dengan blazer formal yang rapi (sesuai jenis kelamin), berikan latar belakang polos (abu-abu muda), dan pastikan pencahayaan studio yang merata. Ekspresi harus terlihat profesional dan meyakinkan.";
            
            // Gunakan instruksi default, tambahkan prompt pengguna jika ada.
            const finalPrompt = userPrompt ? `${defaultInstruction} Tambahan instruksi: ${userPrompt}` : defaultInstruction;


            const payload = {
                contents: [{
                    parts: [
                        { text: finalPrompt },
                        {
                            inlineData: {
                                mimeType: uploadedMimeType,
                                data: uploadedBase64
                            }
                        }
                    ]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };

            // Logika untuk exponential backoff
            const maxRetries = 3;
            let attempt = 0;

            while (attempt < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxRetries - 1) {
                            // Too Many Requests, retry with backoff
                            const delay = Math.pow(2, attempt) * 1000; // 1s, 2s, 4s
                            await new Promise(resolve => setTimeout(resolve, delay));
                            attempt++;
                            continue;
                        }
                        const errorData = await response.json();
                        throw new Error(`API Error ${response.status}: ${errorData.error?.message || 'Gagal menghasilkan gambar.'}`);
                    }

                    const result = await response.json();
                    
                    // Ekstraksi Base64 dari respon
                    const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                    if (!base64Data) {
                        throw new Error("Respons API tidak mengandung data gambar.");
                    }

                    const imageUrl = `data:image/png;base64,${base64Data}`;

                    // Tampilkan hasil
                    resultImage.src = imageUrl;
                    resultContainer.classList.remove('hidden');
                    downloadBtn.href = imageUrl;
                    downloadBtn.classList.remove('hidden');

                    showMessage("Headshot CV berhasil dibuat! Silakan unduh gambar Anda.", 'success');
                    break; // Keluar dari loop jika berhasil

                } catch (error) {
                    // Penanganan error
                    console.error("Kesalahan dalam panggilan API:", error);
                    showMessage(`Gagal memproses gambar: ${error.message}`, 'error');
                    break; // Keluar dari loop jika error fatal

                } finally {
                    // Reset status loading
                    generateBtn.disabled = false;
                    loadingSpinner.classList.add('hidden');
                    buttonText.textContent = 'Ubah Foto Jadi Headshot (AI)';
                }
            }
        });


        // --- 3. WORD SEARCH GAME LOGIC (Konversi dari kode user, dimodifikasi untuk integrasi) ---

        const gameData = [
            { word: "SEPTEMBER", fact: "Pendaftaran MBD ISTTS biasanya dibuka bulan September 2025." },
            { word: "HYBRID", fact: "MBD ISTTS menerapkan sistem kuliah Hybrid (Online & Offline)." },
            { word: "TANPA SKRIPSI", fact: "Keunggulan utama: Tidak mewajibkan Skripsi, tapi fokus ke proyek nyata." },
            { word: "MAGANG", fact: "Kesempatan magang (kerja praktik) sudah bisa dimulai setelah 2,5 tahun kuliah." },
            { word: "BEASISWA", fact: "Diskon 100% smt 1 & 50% smt 2-7 untuk 10 pendaftar pertama!" },
            { word: "DATA ANALYST", fact: "Salah satu prospek karir utama lulusan MBD adalah menjadi Data Analyst." },
            { word: "ENTREPRENEUR", fact: "Lulusan dibekali skill untuk menjadi Pendiri Bisnis Digital." },
            { word: "ECOMMERCE", fact: "Kurikulum mencakup pemasaran digital dan manajemen E-commerce." },
            { word: "LAB KOMPUTER", fact: "Fasilitas lengkap termasuk Lab dengan software analisis data & desain." },
            { word: "MITRA INDUSTRI", fact: "ISTTS punya jaringan mitra industri kuat untuk jaminan magang." },
            { word: "STRATEGI BISNIS", fact: "Kurikulum mengintegrasikan strategi bisnis konvensional dengan teknologi." },
            { word: "TUJUH BELAS", fact: "Syarat usia minimal pendaftar adalah 17 tahun." }
        ];

        const GRID_SIZE = 16; 
        let grid = [];
        let foundCount = 0;
        let isSelecting = false;
        let startCell = null;
        let currentSelection = [];

        const gridContainer = document.getElementById('grid-container');
        const wordListContainer = document.getElementById('word-list');
        const statusMsg = document.getElementById('status-msg');
        const factBox = document.getElementById('fact-box');
        const factText = document.getElementById('fact-text');
        const scoreEl = document.getElementById('score');
        const resetGameBtn = document.getElementById('reset-game-btn');

        // Setup Grid Style
        if (gridContainer) {
            gridContainer.style.gridTemplateColumns = `repeat(${GRID_SIZE}, minmax(0, 1fr))`;
        }
        

        function initGame() {
            // Bersihkan Event Listener yang mungkin menumpuk
            document.removeEventListener('mouseup', stopSelection);
            document.removeEventListener('touchend', stopSelection);
            resetGameBtn.onclick = initGame; // Reset game
            
            // Reset state
            grid = Array(GRID_SIZE).fill().map(() => Array(GRID_SIZE).fill(''));
            foundCount = 0;
            scoreEl.innerText = `0/${gameData.length}`;
            statusMsg.innerText = '';
            factBox.classList.add('hidden');
            
            gridContainer.innerHTML = '';
            wordListContainer.innerHTML = '';

            // 1. Place Words
            const sortedData = [...gameData].sort((a, b) => b.word.length - a.word.length);
            
            sortedData.forEach(item => {
                placeWord(item.word);
            });

            // 2. Fill Empty Spaces
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (grid[r][c] === '') {
                        grid[r][c] = letters.charAt(Math.floor(Math.random() * letters.length));
                    }
                }
            }

            // 3. Render Grid
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.innerText = grid[r][c];
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    // Event Listeners
                    cell.addEventListener('mousedown', handleStart);
                    cell.addEventListener('mouseover', handleMove);
                    cell.addEventListener('mouseup', handleEnd);
                    cell.addEventListener('touchstart', (e) => { e.preventDefault(); handleStart(e); });
                    cell.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(e); });
                    cell.addEventListener('touchend', (e) => { e.preventDefault(); handleEnd(e); });

                    gridContainer.appendChild(cell);
                }
            }

            // 4. Render Word List
            gameData.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('word-item');
                div.innerText = item.word;
                div.dataset.word = item.word.replace(/\s/g, '').toUpperCase(); // Simpan versi tanpa spasi untuk checking
                wordListContainer.appendChild(div);
            });

            // Tambahkan listener global untuk menghentikan seleksi
            document.addEventListener('mouseup', stopSelection);
            document.addEventListener('touchend', stopSelection);
        }

        function placeWord(rawWord) {
            const word = rawWord.replace(/\s/g, '').toUpperCase();
            let placed = false;
            let attempts = 0;
            // Arah: Horizontal, Vertikal, Diagonal
            const directions = [
                {r: 0, c: 1}, {r: 1, c: 0}, {r: 1, c: 1}, {r: -1, c: 1} 
            ];

            while (!placed && attempts < 150) {
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const startR = Math.floor(Math.random() * GRID_SIZE);
                const startC = Math.floor(Math.random() * GRID_SIZE);

                let fits = true;
                for (let i = 0; i < word.length; i++) {
                    const r = startR + dir.r * i;
                    const c = startC + dir.c * i;
                    // Check boundary dan bentrokan karakter
                    if (r < 0 || r >= GRID_SIZE || c < 0 || c >= GRID_SIZE || (grid[r][c] !== '' && grid[r][c] !== word[i])) {
                        fits = false; break;
                    }
                }

                if (fits) {
                    for (let i = 0; i < word.length; i++) {
                        grid[startR + dir.r * i][startC + dir.c * i] = word[i];
                    }
                    placed = true;
                }
                attempts++;
            }
        }

        // --- Interaction Logic ---

        function getEventTarget(e) {
            if (e.touches && e.touches.length > 0) {
                const touch = e.touches[0];
                return document.elementFromPoint(touch.clientX, touch.clientY);
            }
            return e.target;
        }

        function handleStart(e) {
            const target = getEventTarget(e);
            if (!target || !target.classList.contains('cell') || target.classList.contains('found')) return;
            isSelecting = true;
            startCell = { r: parseInt(target.dataset.row), c: parseInt(target.dataset.col) };
            highlightCells(startCell, startCell);
        }

        function handleMove(e) {
            if (!isSelecting) return;
            const target = getEventTarget(e);
            if (!target || !target.classList.contains('cell')) return;
            const currentR = parseInt(target.dataset.row);
            const currentC = parseInt(target.dataset.col);
            highlightCells(startCell, {r: currentR, c: currentC});
        }

        function handleEnd(e) {
            if (!isSelecting) return;
            stopSelection();
        }

        function highlightCells(start, end) {
            // Hapus seleksi visual sebelumnya
            document.querySelectorAll('#grid-container .cell.selected').forEach(c => c.classList.remove('selected'));
            
            const cells = getCellsInLine(start, end);
            currentSelection = cells;
            cells.forEach(pos => {
                const idx = pos.r * GRID_SIZE + pos.c;
                const cell = gridContainer.children[idx];
                if (cell && !cell.classList.contains('found')) cell.classList.add('selected');
            });
        }

        function stopSelection() {
            if (!isSelecting) return;
            isSelecting = false;
            
            if (currentSelection.length > 0) checkMatch();
            
            // Hapus seleksi visual setelah pengecekan
            document.querySelectorAll('#grid-container .cell.selected').forEach(c => c.classList.remove('selected'));
            currentSelection = [];
        }

        function getCellsInLine(start, end) {
            const dr = end.r - start.r;
            const dc = end.c - start.c;
            
            if (dr === 0 && dc === 0) return [{r: start.r, c: start.c}];
            
            // Cek apakah garis lurus (Horizontal, Vertikal, atau Diagonal 45/135 derajat)
            if (dr !== 0 && dc !== 0 && Math.abs(dr) !== Math.abs(dc)) return []; 
            
            const steps = Math.max(Math.abs(dr), Math.abs(dc));
            const stepR = dr === 0 ? 0 : dr / Math.abs(dr);
            const stepC = dc === 0 ? 0 : dc / Math.abs(dc);
            
            const cells = [];
            for (let i = 0; i <= steps; i++) {
                cells.push({ r: start.r + i * stepR, c: start.c + i * stepC });
            }
            return cells;
        }

        function checkMatch() {
            let selectedStr = "";
            currentSelection.forEach(pos => selectedStr += grid[pos.r][pos.c]);
            const reversedStr = selectedStr.split('').reverse().join('');

            // Cari match di data
            const match = gameData.find(item => {
                const cleanWord = item.word.replace(/\s/g, '').toUpperCase();
                return cleanWord === selectedStr || cleanWord === reversedStr;
            });

            if (match) {
                const wordEl = document.querySelector(`.word-item[data-word="${match.word.replace(/\s/g, '').toUpperCase()}"]`);
                
                if (wordEl && !wordEl.classList.contains('found')) {
                    // 1. Mark as Found Visuals
                    currentSelection.forEach(pos => {
                        const idx = pos.r * GRID_SIZE + pos.c;
                        const cell = gridContainer.children[idx];
                        if (cell) cell.classList.add('found');
                    });
                    wordEl.classList.add('found');
                    
                    // 2. Update Stats
                    foundCount++;
                    scoreEl.innerText = `${foundCount}/${gameData.length}`;
                    statusMsg.innerText = `HEBAT! ${match.word}`;
                    
                    // 3. Show Fact Popup
                    showFact(match);

                    // 4. Check Win
                    if (foundCount === gameData.length) {
                        statusMsg.innerText = "SELAMAT! KAMU MENGENAL MBD ISTTS DENGAN BAIK! ";
                        confettiEffect();
                    }
                }
            }
        }

        function showFact(item) {
            factText.innerText = item.fact;
            factBox.classList.remove('hidden');
            factBox.classList.add('info-popup');
            
            // Reset style jika sebelumnya sudah menang
            factBox.style.backgroundColor = ""; 
            factBox.style.borderColor = ""; 
            const factTitle = document.querySelector('#fact-box h4');
            factTitle.innerText = "TAHUKAH KAMU?";
            factTitle.classList.remove('text-blue-700');
            factTitle.classList.add('text-orange-700');


            // Remove animation class after plays to allow replay
            setTimeout(() => {
                factBox.classList.remove('info-popup');
            }, 500);
        }

        function confettiEffect() {
            // Simple visual cue for win
            factBox.style.backgroundColor = "#dbeafe"; // blue-100
            factBox.style.borderColor = "#2563eb"; // blue-600
            const factTitle = document.querySelector('#fact-box h4');
            factTitle.innerText = "CONGRATULATIONS!";
            factTitle.classList.remove('text-orange-700');
            factTitle.classList.add('text-blue-700');
            
            factText.innerText = "Kamu telah menyelesaikan permainan MBD ISTTS Word Search.";
        }

        // --- 4. Initial Load ---
        window.onload = () => {
            setView('home');
        };
    </script>
</body>
</html>